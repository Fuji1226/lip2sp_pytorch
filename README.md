# 動画音声合成のベースライン

ここがベースとなる基本的なブランチになります。
以下、実行までの手順です！

## リポジトリのクローン
ホームディレクトリでクローンをお願いします（ターミナルでcdと打った時の状態）。

`git clone https://github.com/Fuji1226/lip2sp_pytorch.git`

## Dockerのインストール
Dockerを使って仮想環境を立てる必要があるので、まずはそれのインストールをお願いします。

おそらく以下のURLからやっていただくと良いと思います。もしダメだった場合、「Docker mac」とかで検索してみてください。

https://docs.docker.com/desktop/install/mac-install/

## Dockerイメージのビルド
まずは、リモートのbaselineブランチをもとにローカルブランチを作成してください。

`git checkout -b ローカルブランチ名 origin/baseline`

次に、DockerfileをもとにDockerイメージをビルドします。
以下のコマンドの場合、ビルドされるイメージの名前は`-t`の次にある`lip2sp_pytorch`です。
ここは自由につけていただいて構いませんが、わかりやすい方が良いかなと思い、とりあえずGitHubのリポジトリ名をつけています。

`docker build -t lip2sp_pytorch .`

ビルドには結構時間がかかると思います。

終わったら、`docker image ls`と打ってみて、イメージができていることを確認してください。

## ITOからデータのダウンロード
ローカルではデバッグ作業を行うので、ITOからちょっとデータを持ってきて実行する感じになります。

自分が検証したいデータを適当にダウンロードしてきて、ITOと同じディレクトリ構造で配置してください。

ホームディレクトリにdatasetというディレクトリを作る感じで揃えてください。

## Dockerコンテナの起動
ビルドされたイメージをもとに、作業するためのコンテナを起動します。

`docker run option imageid`

`imageid`は、`docker image ls`と打った時に表示されるIMAGE IDのことです。
ここをコピペしてください。

`option`は、コンテナ実行時のオプションになります。
調べていただくと色々あるのですが、とりあえず以下のオプションを設定しておけば事足りるかと思います。

* `--rm`：これを書くことで、作業終了時にコンテナを停止した際、コンテナが自動で削除されます。書かなかった場合コンテナは残り続けるので、とりあえず書いておいて良い気がします。もし同じコンテナを繰り返し使いたいというこだわりがあれば、こちらは書かないで大丈夫です。自分はそういったこだわりがないので、毎回消して新しいコンテナを作ってます。
* `—-mount type=bind,src=マウントしたい対象までのパス,dst=マウント先のパス`：これを書くことで、コンテナにローカルのファイルをバインドマウントすることができます。バインドマウントすることで、コンテナの中で作業した結果がローカルに反映されます。コマンド内の`-type`によってマウントの仕方が変わるので、コンテナ内で作業した結果をローカルに反映したくない場合などあれば、調べてみてください。自分はあまりそういった場面がないので、基本バインドマウントしてます。
* `-it`：これにより、コンテナ起動時にシェルが起動してくれます。VSCodeで言うところのターミナルが起動する感じです。

下記のような感じで実行します。

## VSCodeで起動したコンテナに接続
起動したコンテナにVSCodeに接続することで、コードをいじれるようになります。

「vscode dockerコンテナ 接続」とかで検索すると出てくるので、やってみてください。
VSCodeの拡張機能である「Dev Containers」というものを利用する感じです。

下記のURLなど参考にしていただくと良いかと思います。

https://tech.nri-net.com/entry/using_docker_containers_with_vscode